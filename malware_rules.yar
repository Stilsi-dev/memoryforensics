rule Mimikatz_Indicators {
    meta:
        description = "Detects indicators of Mimikatz credential dumping tool"
        author = "MemoryForensics Group 2"
        date = "2023-11-15"
    strings:
        $m1 = "mimikatz" nocase
        $m2 = "sekurlsa::logonpasswords"
        $m3 = "kerberos::ptt"
        $m4 = "privilege::debug"
    condition:
        any of them
}

rule CobaltStrike_Beacon {
    meta:
        description = "Detects Cobalt Strike beacon indicators"
        author = "MemoryForensics Group 2"
    strings:
        $cs1 = "beacon.dll" nocase
        $cs2 = "ReflectiveLoader" nocase
        $cs3 = "beacon.x64.dll" nocase
    condition:
        any of them
}

rule PowerShell_Exploitation {
    meta:
        description = "Detects common PowerShell exploitation patterns"
        author = "MemoryForensics Group 2"
    strings:
        $ps1 = "-nop -exec bypass" nocase
        $ps2 = "Invoke-" nocase
        $ps3 = "IEX (New-Object Net.WebClient).DownloadString"
    condition:
        any of them
}

rule Process_Injection {
    meta:
        description = "Detects common process injection techniques"
        author = "MemoryForensics Group 2"
    strings:
        $pi1 = "CreateRemoteThread"
        $pi2 = "WriteProcessMemory"
        $pi3 = "VirtualAllocEx"
    condition:
        all of them
}

rule Ransomware_Indicators {
    meta:
        description = "Detects common ransomware strings"
        author = "MemoryForensics Group 2"
    strings:
        $r1 = "AES-256" nocase
        $r2 = "Your files have been encrypted" nocase
        $r3 = "TOR payment site" nocase
    condition:
        any of them
}

rule Suspicious_Process_Paths {
    meta:
        description = "Detects processes running from suspicious locations"
        author = "MemoryForensics Group 2"
    strings:
        $sp1 = "\\temp\\" nocase
        $sp2 = "\\appdata\\" nocase
        $sp3 = "\\programdata\\" nocase
    condition:
        any of them and filesize < 10MB
}

rule Credential_Dumping_Tools {
    meta:
        description = "Detects various credential dumping tools"
        author = "MemoryForensics Group 2"
    strings:
        $cd1 = "procdump" nocase
        $cd2 = "lsass.dmp" nocase
        $cd3 = "comsvcs.dll" nocase
    condition:
        any of them
}

rule Malicious_Office_Macros {
    meta:
        description = "Detects common malicious Office macro patterns"
        author = "MemoryForensics Group 2"
    strings:
        $mo1 = "AutoOpen()"
        $mo2 = "Shell("
        $mo3 = "WScript.Shell"
    condition:
        any of them
}

rule Web_Shell_Indicators {
    meta:
        description = "Detects common web shell patterns"
        author = "MemoryForensics Group 2"
    strings:
        $ws1 = "eval($_POST[" nocase
        $ws2 = "system($_GET[" nocase
        $ws3 = "passthru(" nocase
    condition:
        any of them
}

rule Malware_Strings_Generic {
    meta:
        description = "Generic malware strings found in many malware families"
        author = "MemoryForensics Group 2"
    strings:
        $g1 = "MZ" // PE header
        $g2 = "This program cannot be run in DOS mode"
        $g3 = "UPX!" // UPX packed
    condition:
        ($g1 and $g2) or $g3
}